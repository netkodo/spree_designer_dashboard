<div class="row">
  <div class="col-md-3">
    <%= render :partial => "dashboard_menu", :locals => {:selected => "dashboard"}%>
  </div>

  <div class="col-md-9">
    <div class="page-header clearfix">
      <div class="row">
        <div class="col-md-12 header-actions">


          <% if @designer_type == "room designer" %>
              <div class="row menu-public">
                <%= link_to "Add a Room", new_room_path(private: false), :class => "btn btn-primary btn-no-radius" %>
              </div>
              <div class="row menu-private hidden">
                <% unless @projects.present? %>
                  <div class="col-md-12 text-center">
                    <h1>You don't have any projects</h1>
                    <%= link_to "Add One", new_project_path, :class => "btn btn-primary btn-no-radius" %>
                  </div>
                <% else %>
                  <div class="col-md-12 text-center">
                    <h1 id="h1_project_name"></h1>
                  </div>
                  <div class="row">
                    <div class="col-md-6 col-md-offset-3">
                      <%= select_tag :project_select, options_for_select(@projects.map{|p| [p.project_name,p.id]}.unshift(["Start or Select Project","",{disabled: 'disabled'}],["Start New Project","new_project",{class: 'bold'}],["--------------------------------","divider",{disabled: 'disabled', class: 'text-center'}]),""), :class => 'form-control' %>
                    </div>
                  </div>
                    <div class="project-managment hidden">
                    <div class="row mtop">
                      <div class="col-md-6 col-md-offset-3">
                      <%= select_tag :project_action, options_for_select([["Select an Option","",{disabled: 'disabled'}],["Edit/View Project Details","project-details"],["Add a Room for this Project","add-room"],["End Project","end-project"],["Remove Project","remove-project"]],""),class:"form-control", data: {id: "", status: "close"} %>
                      </div>
                    </div>
                    <div class="row mtop">
                      <div class="col-md-12 text-center">
                        <div id="submit-action" class="btn btn-primary btn-no-radius">Submit</div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% elsif @designer_type == "to the trade designer" %>
              <%= link_to "Add a Private Room", new_room_path(private: true), :class => "btn btn-primary btn-no-radius" %>
            <% end %>
        </div>

      </div>
    </div>
    <div class="room-type-buttons">
      <% if @designer_type == "room designer" %>
          <div class="btn btn-default btn-tab js-get-room-type active" data-private="false">Public</div>
          <div class="btn btn-default btn-tab js-get-room-type" data-private="true">Private</div>
      <% elsif @designer_type == "to the trade designer" %>
          <div class="btn btn-default btn-tab js-get-room-type active" data-private="true">Private</div>
      <% end %>
    </div>


    <% unless @boards.blank? %>
        <table class="table table-board-listing">
          <colgroup>
            <col style="width: 5%" />
            <col style="width: 20%" />
            <col style="width: 40%" />
            <col style="width: 12%" />
            <col style="width: 10%" />
            <col style="width: 10%" />
          </colgroup>
          <thead>
          <tr>
            <th class="status">&nbsp;</th>
            <th colspan="2"></th>
            <th class="align-center"># Products</th>
            <th class="align-center"># Views</th>
            <th class="align-center">Revenue</th>
          </tr>
          </thead>
          <tbody class="dashboard">
          <%# cache @board do %>
            <% @boards.each do |board|%>
              <% cache board do %>
                <tr id="<%= board.id %>" class="<%= board.private %> <%= board.private ? 'hidden' : '' %> board<%= board.id %> <%= !board.generated ? 'generating' : '' %> <%= board.project.present? ? "project#{board.project.id}" : "" %>">
                  <td class="status"><span class="label label-<%= board.display_short_status.downcase %>"><%= board.display_short_status %></span></td>
                  <td class="board-thumb">
                    <% if board.generated %>
                      <%= board_image(board,:small)%>
                    <% else %>
                      <%= image_tag("/assets/frontend/boards/small_generated.png", class: 'img-responsive')%>
                    <% end %>
                  </td>
                  <td class="board-title">
                    <%= board.name %>
                    <div class="board-actions" data-board_id="<%= board.id %>" data-user_id="<%= spree_current_user.id %>">
                      <% if board.generated %>
                        <% if board.private %>
                          <%= render partial: "board_actions_private", locals: {board: board} %>
                        <% else %>
                          <%= render partial: "board_actions_public", locals: {board: board} %>

                        <% end %>
                      <% end %>

                    </div>
                  </td>
                  <% unless board.private %>
                    <%= render partial: "board_public_columns", locals: {board: board} %>
                  <% end %>


                </tr>
              <% end %>
            <% end %>
          <%# end %>
          </tbody>
        </table>
        <%- if spree_current_user.designer_commission.present?  %>
            <div class="board-title designer_commission_style hidden">
              <%=  "Total earned: #{number_to_currency(spree_current_user.designer_commission)}" %>
            </div>
            <div class="board-title designer_commission_style hidden">
              <%= "Total paid: #{number_to_currency(spree_current_user.total_affiliate_payments_amount)}" %>
            </div>
            <div class="board-title designer_commission_style hidden">
              <%= "Total due: #{number_to_currency(spree_current_user.afilliate_balance_due)}" %>
            </div>
        <%- end%>
    <% else %>
        <div class="empty-state empty-tabs">You have not created any rooms yet.</div>
    <% end %>
  </div>
</div>

<div id="board-history-modal-handler"></div>

<%= render partial: 'after_submit_to_publish_modal' %>
<%= render partial: 'dashboard_welcome_modal' %>

<script>
    $('#new_room_button').popover();
    if($('.table.table-board-listing tbody tr').length == 1 && document.referrer.match('design') != null && <%= session[:page_count]==0 ? true:false %>) {
      tutorial = new EnjoyHint({});
      dashboard_after_save = [
        {
          'click .board-actions' : "Now that you've saved your room, you can preview it to ensure it is exacly how you want it. You can hiy Edit to make changes to your room, or you can \"Submit to Publish\" if your room is finished and you are ready for it to go live."
        }
      ];
      tutorial.set(dashboard_after_save);
      tutorial.run();
    }
</script>